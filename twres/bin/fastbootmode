#!/bin/bash
clear
echo "Fastboot without reboot"

setprop sys.usb.config none

UDC_CONTROLLER="$(getprop sys.usb.controller)"
if [ -z "$UDC_CONTROLLER" ]; then
    echo "UDC CONTROLLER not found skip this"
fi

echo "Set paramenter for fastboot..."
echo "0xD001" > /config/usb_gadget/g1/idProduct
echo "fastboot" > /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration

rm -f /config/usb_gadget/g1/configs/b.1/f1
rm -f /config/usb_gadget/g1/configs/b.1/ffs.mtp

ln -s /config/usb_gadget/g1/functions/ffs.fastboot /config/usb_gadget/g1/configs/b.1/f1

echo "This UDC CONTROLLER : $UDC_CONTROLLER"

echo "$UDC_CONTROLLER" > /config/usb_gadget/g1/UDC

# Attempt fo turn on fastboot
setprop sys.usb.config fastboot
start fastbootd

echo "-----------------------------------"
echo "Fastboot USB configuration complete."
echo "Fastboot active type in cmd or terminal 'fastboot devices'"
echo "Press down + power for exit"